<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>CANVAS</title>
    </head>
    <body>
        <canvas id="canvas" style="border: 1px solid #666;"></canvas>

        <script type="text/javascript" src="../js/jquery.min.js"></script>
        <script type="text/javascript" src="../js/app.js"></script>
        <script type="text/javascript">
            var obj = new DrawGrid({
                ready: function(){
                    var _this = this;
                    var d = _this.canvas.toDataURL();
                    console.log(typeof d);
                    $.ajax({
                        type: 'POST',
                        url: 'http://localhost:3000/server/download.action',
                        data:{
                            img: d
                        },
                        success: function(){

                        }
                    });
                }
            });

            $.ajax({
                type: 'GET',
                url: 'http://localhost:3000/server/canvas.action',
                dataType: 'json',
                success: function(data){
                    obj.option.data = data;
                    obj.refresh();

                    // var imgData = obj.canvas.toDataURL('png');
                    // /**
                    //  * 获取mimeType
                    //  * @param  {String} type the old mime-type
                    //  * @return the new mime-type
                    //  */
                    // var _fixType = function(type) {
                    //     type = type.toLowerCase().replace(/jpg/i, 'jpeg');
                    //     var r = type.match(/png|jpeg|bmp|gif/)[0];
                    //     return 'image/' + r;
                    // };
                       
                    // // 加工image data，替换mime type
                    // imgData = imgData.replace(_fixType('png'),'image/octet-stream');
                    // *
                    //  * 在本地进行文件保存
                    //  * @param  {String} data     要保存到本地的图片数据
                    //  * @param  {String} filename 文件名
                     
                    // var saveFile = function(data, filename){
                    //     var save_link = document.createElementNS('http://www.w3.org/1999/xhtml', 'a');
                    //     save_link.href = data;
                    //     save_link.download = filename;
                       
                    //     var event = document.createEvent('MouseEvents');
                    //     event.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
                    //     save_link.dispatchEvent(event);
                    // };
                    // // download
                    // saveFile(imgData,'a.jpg');
                }
            });
        </script>
    </body>
</html>